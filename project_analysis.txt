============================================================
ğŸš€ ĞŸĞĞ›ĞĞ«Ğ™ ĞĞ¢Ğ§Ğ•Ğ¢ Ğ ĞŸĞ ĞĞ•ĞšĞ¢Ğ• Ğ”Ğ›Ğ¯ Ğ˜Ğ˜
============================================================

ğŸ“‹ ĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ• ĞŸĞ ĞĞ•ĞšĞ¢Ğ
----------------------------------------
=== README.md ===
Store Analytics Project Documentation
ğŸ¯ Project Overview
Store Analytics with Heatmap Detection - ÑÑ‚Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ĞºĞ¾Ğ¼Ğ¿ÑŒÑÑ‚ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ñ€ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿Ğ¾ÑĞµÑ‰Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ° Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸. ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ»ÑĞ´ĞµĞ¹, ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ Ñ‚ĞµĞ¿Ğ»Ğ¾Ğ²Ñ‹Ğµ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°.

ğŸ—ï¸ Architecture Overview
text
Flask Web Server (8001)
        â†“
    Camera Stream (RTSP)
        â†“
   YOLOv8 Detection
        â†“
   Heatmap Processing
        â†“
   Data Storage & Visualization
ğŸ“ Critical Files Structure
ğŸ¯ CORE FILES (Must Read First)
app/main.py - Application entry point

Flask app initialization

Startup/shutdown handlers

Main execution flow

app/config/settings.py - Configuration center

Camera settings (URL, timeouts)

Model parameters (YOLO paths, confidence thresholds)

Heatmap configuration (save intervals, visualization)

Application settings (host, port, debug mode)

app/core/camera.py - Video processing core

RTSP stream handling

Frame capture and processing

Detection coordination

Reconnection logic

app/core/heatmap.py - Analytics engine

Heatmap accumulation algorithms

Statistical calculations

Data persistence

Visualization overlay

app/services/detection.py - AI detection service

YOLOv8 model integration

Object tracking and identification

Bounding box processing

app/api/routes.py - Web interface

Flask route definitions

HTTP endpoints

Video streaming implementation

Statistics API

ğŸ”§ SUPPORTING FILES
app/services/storage.py - Data management

File system operations

Heatmap data serialization

Cleanup and organization

requirements.txt - Dependencies

Python package requirements

Version specifications

ğŸ”„ Data Flow
text
RTSP Stream â†’ Frame Capture â†’ YOLO Detection â†’ Bounding Boxes â†’ Heatmap Update â†’ Web Display
                                     â†“
                              Statistics Calculation
                                     â†“
                              Data Persistence
ğŸ› ï¸ Key Components Deep Dive
Camera Management (app/core/camera.py)
python
# Key responsibilities:
- RTSP connection management
- Frame decoding and preprocessing
- Thread-safe operations
- Automatic reconnection
- Detection coordination
Heatmap Engine (app/core/heatmap.py)
python
# Key algorithms:
- Gaussian heat accumulation
- Activity time calculation
- Statistical analysis
- Data serialization/deserialization
- Visualization overlay
AI Detection (app/services/detection.py)
python
# Key features:
- YOLOv8 person detection
- Object tracking with persistence
- Confidence filtering
- Real-time performance optimization
âš™ï¸ Configuration Points
Camera Settings (app/config/settings.py)
python
CAMERA_URL = "rtsp://admin:password@ip:port/path"  # RTSP stream URL
RECONNECT_TIMEOUT = 5  # Reconnection delay in seconds
Model Configuration
python
MODEL_PATH = "yolov8n.pt"  # YOLO model weights
TARGET_CLASSES = [0]       # 0 = person detection
CONFIDENCE_THRESHOLD = 0.5 # Detection sensitivity
Heatmap Settings
python
SAVE_INTERVAL = 300        # Auto-save every 5 minutes
GAUSSIAN_RADIUS = 30       # Heat point spread
OVERLAY_ALPHA = 0.3        # Heatmap transparency
ğŸŒ API Endpoints
GET / - Main video feed with heatmap overlay

GET /video_feed - Raw MJPEG video stream

GET /statistics - JSON statistics and web interface

GET /reset_heatmap - Reset accumulated heatmap data

GET /save_heatmap - Manual heatmap save trigger

ğŸš€ Development Guidelines
Adding New Features
Configuration Changes - Start with app/config/settings.py

Core Logic - Modify app/core/ files

Web Interface - Update app/api/routes.py

New Services - Create in app/services/

Modifying Detection Logic
Edit app/services/detection.py for object detection changes

Modify confidence thresholds, classes, or tracking parameters

Changing Heatmap Behavior
Update algorithms in app/core/heatmap.py

Modify accumulation, visualization, or statistics

Adding New API Routes
Extend app/api/routes.py with new Flask routes

Follow existing patterns for consistency

ğŸ”§ Troubleshooting Common Issues
Camera Connection Problems
Check RTSP URL in settings

Verify network connectivity

Review reconnection logic in camera.py

Performance Optimization
Adjust frame processing in camera.py

Modify detection intervals

Optimize heatmap update frequency

Memory Management
Monitor heatmap accumulation

Check data persistence in storage.py

Review cleanup procedures

ğŸ“Š Data Persistence
Heatmap Storage
Location: data/saved_heatmaps/YYYYMMDD/

Formats: NPZ (data), PNG (images), JSON (metadata)

Auto-cleanup: Keeps only latest per day

Statistics
Real-time calculation from heatmap data

Human-readable activity time

Maximum/average activity levels

ğŸ¨ Customization Areas
Easy Modifications
Visualization colors and styles

Statistical calculations

Save intervals and data retention

Detection sensitivity

Advanced Customizations
Multiple camera support

Different AI models

Database integration

Advanced analytics

Mobile app interface

ğŸ“ˆ Scaling Considerations
Current 

... (Ñ„Ğ°Ğ¹Ğ» ÑƒÑĞµÑ‡ĞµĞ½, Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸)


âš™ï¸ ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜ĞĞĞĞ«Ğ• Ğ¤ĞĞ™Ğ›Ğ«
----------------------------------------
--- ğŸ Python Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (requirements.txt) ---
blinker==1.9.0
certifi==2025.11.12
charset-normalizer==3.4.4
click==8.3.0
contourpy==1.3.2
cycler==0.12.1
filelock==3.20.0
Flask==2.3.3
fonttools==4.60.1
fsspec==2025.10.0
idna==3.11
itsdangerous==2.2.0
Jinja2==3.1.6
kiwisolver==1.4.9
MarkupSafe==3.0.3
matplotlib==3.10.7
mpmath==1.3.0
networkx==3.4.2
numpy==1.24.3
nvidia-cublas-cu12==12.8.4.1
nvidia-cuda-cupti-cu12==12.8.90
nvidia-cuda-nvrtc-cu12==12.8.93
nvidia-cuda-runtime-cu12==12.8.90
nvidia-cudnn-cu12==9.10.2.21
nvidia-cufft-cu12==11.3.3.83
nvidia-cufile-cu12==1.13.1.3
nvidia-curand-cu12==10.3.9.90
nvidia-cusolver-cu12==11.7.3.90
nvidia-cusparse-cu12==12.5.8.93
nvidia-cusparselt-cu12==0.7.1
nvidia-nccl-cu12==2.27.5
nvidia-nvjitlink-cu12==12.8.93
nvidia-nvshmem-cu12==3.3.20
nvidia-nvtx-cu12==12.8.90
opencv-python==4.8.1.78
packaging==25.0
pandas==2.3.3
pillow==12.0.0
psutil==7.1.3
py-cpuinfo==9.0.0
pyparsing==3.2.5
python-dateutil==2.9.0.post0
python-dotenv==1.0.0
pytz==2025.2
PyYAML==6.0.3
requests==2.32.5
scipy==1.15.3
seaborn==0.13.2
six==1.17.0
sympy==1.14.0
torch==2.9.1
torchvision==0.24.1
tqdm==4.67.1
triton==3.5.1
typing_extensions==4.15.0
tzdata==2025.2
ultralytics==8.0.186
urllib3==2.5.0
Werkzeug==3.1.3

--- ğŸ³ Docker ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (Dockerfile) ---
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

RUN mkdir -p data/saved_heatmaps logs

EXPOSE 8001

CMD ["python", "-m", "app.main"]


ğŸŒ³ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ ĞŸĞ ĞĞ•ĞšĞ¢Ğ
----------------------------------------
ğŸ“ /
ğŸ“ ĞŸÑƒÑ‚ÑŒ: /home/andvar/store_analytics

â”œâ”€â”€ ğŸ“ app/
â”‚   â”œâ”€â”€ ğŸ“ api/
â”‚   â”œâ”€â”€ ğŸ“ config/
â”‚   â”œâ”€â”€ ğŸ“ core/
â”‚   â”œâ”€â”€ ğŸ“ services/
â”‚   â”œâ”€â”€ ğŸ“ static/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ css/
â”‚   â”‚   â””â”€â”€ ğŸ“ js/
â”‚   â””â”€â”€ ğŸ“ utils/
â”œâ”€â”€ ğŸ“ data/
â”‚   â”œâ”€â”€ ğŸ“ models/
â”‚   â””â”€â”€ ğŸ“ saved_heatmaps/
â”œâ”€â”€ ğŸ“ logs/
â”œâ”€â”€ ğŸ“ saved_heatmaps/
â”‚   â””â”€â”€ ğŸ“ 20251113/
â”œâ”€â”€ ğŸ“ tests/
â”œâ”€â”€ ğŸ“„ Dockerfile
â””â”€â”€ ğŸ“„ LICENSE